# 第二章 在HTML中使用JavaScript
本章内容：
- 使用script标签
- 嵌入脚本与外部脚本
- 文档模式对JavaScript的影响
- 考虑禁用JavaScript的场景

只要一提到把JavaScript放到网页中，就不得不说Web的核心之一：HTML。在当初开发JavaScript的时候，Netscape要解决的一个重要问题就是如何做到让JavaScript既能与HTML页面共存，又不影响那些页面在其它浏览器中的呈现效果。经过尝试、纠错和争论，最终的决定就是为Web增加统一的脚本支持。而Web诞生早期的很多做法也都沿用了下来，并被正式纳入HTML规范当中。

## 2.1 `<script>`标签
向HTML页面中插入JavaScript的主要方法，就是使用`<script>`元素。这个元素由Netscape创造并在Netscape Navigator2中首次实现。后来，这个元素被加入到正式的HTML规范中。HTML4.01为`<script>`定义了以下6个属性：
1. async：表示应该立即下载脚本，但是不妨碍页面中的其它操作，比如下载其它资源或等待加载其它脚本。
2. charset：表示通过src属性指定的代码的字符集。大多数浏览器会忽略掉它的值。
3. defer：表示脚本可以延迟到文档完全被解析和显示之后再执行。
4. src：表示包含要执行代码的外部文件
5. language。已废弃
6. type：表示脚本语言的内容类型，较少使用。

使用script标签的方式有两种：直接在页面中内嵌js代码或者包含外部js代码。

包含在script标签内部的js代码被从上至下依次解释。在解释器对script元素内部的所有代码执行完毕之前，页面中的其余内容都不会被浏览器加载或者显示。

在使用script内嵌js代码时，记住不要在代码中的任何地方出现`</script>`字符串，否则浏览器会产生错误，因为浏览器遇到字符串`</script>`就会认为那是结束的标签，通过把这个字符串分割为两部分就可以解决上述问题：
```js
<script>
function say() {
    alert('</script>');
}
</script>
```
如果要通过`script`标签来包含外部js文件，那么src属性就是必需的。如：
```html
<script src="example.js"></script>
```
外部文件example.js被加载到当前页面中。与内嵌js代码一样，在解析外部js文件包括下载该文件时，页面的处理也会暂时停止。

需要注意的是，带有src属性的`script`标签内部之间不应再包含内嵌的js代码，假设包含了js代码，则内嵌的js代码会被忽略。

通过`script`标签的src属性还可以包含来自外部域的js文件。如果想包含来自不同域的代码，为了安全考虑，要么你是那个域的所有者，要么那个域的所有者值得信赖。

### 2.1.1 标签的位置
按照惯例，所有script元素都会放在页面的head标签之中。这种做法就是把所有外部文件（也包括css文件）的引用都放在相同的地方。可是，在head标签中包含所有的js文件，意味着必须等到全部js代码都被下载解析执行完成之后，才开始呈现页面的内容。对于那些需要很多js代码的页面来说，这无形之中会导致页面在呈现内容时出现明显的延迟，而延迟期间的浏览器窗口将是一片空白。为了避免这个问题，我们一般都把全部js代码放在body标签中页面内容之后。如下：
```html
<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <script src=""></script>
    <script src=""></script>
</body>
</html>
```
这样，在解析js代码之前，页面内容将完全呈现在浏览器中。

### 2.1.2 延迟脚本
HTML4.01为script标签定义了defer属性。这个属性的用途是表明脚本在执行时不会影响页面的构造，也就是说，脚本会被延迟到整个页面都解析完毕后再运行。因此，在script标签中设置defer属性，相当于告诉浏览器立即下载，但是延迟执行。
```html
<!DOCTYPE html>
<html>
<head>
    <script src="" defer></script>
    <script src="" defer></script>
</head>
<body>

</body>
</html>
```
上述代码中，我们虽然把script标签放在了文档的head标签中，但是其中的脚本将延迟到浏览器遇到`</html>`标签后再执行。上述的js代码会先于DOMContentLoaded事件执行。

### 2.1.3 异步脚本
HTML5为script标签定义了async属性。这个属性与defer属性类似，defer和async只适用于外部脚本文件，async与defer的不同之处是，标记为async的脚本并不能保证按照它们的先后顺序执行。

## 2.2 嵌入代码与外部文件 
在html中内嵌js代码虽然没有问题，但是一般推荐使用外部文件来包含js代码。这么做会有以下几个优点：
1. 可维护性
2. 可缓存：浏览器能够根据具体的设置，缓存所有的外部js文件，也就是说，如果有两个页面都使用同一个js文件，那么这个文件只需下载一次。

## 2.3 `<noscript>`元素
如果浏览器不支持js时，如何让页面平稳地退化。对这个问题地解决方案就是创造一个`<noscript>`元素，用以在不支持javascript的浏览器中显示替代的内容。包含在noscript元素中的内容只有在下列情况中才会显示出来：
1. 浏览器不支持脚本；
2. 浏览器支持脚本，但是脚本被禁用。

## 2.4 小结
把JavaScript插入到HTML页面中要使用script标签。我们需要注意的地方有：
- 在包含外部js文件时，必须将src属性指向相应文件的url。而这个文件可以是其他任何域中的文件。
- 在不使用defer和async的情况下，所有script元素都会按照它们在页面中出现的先后顺序依次被解析。
- 使用defer属性可以让脚本在文档完全呈现之后再执行。defer脚本总是按照指定的顺序执行。
- 使用async属性表示脚本不阻塞文档呈现，当前脚本也不等待其他脚本，不能保证按照指定的顺序执行。
